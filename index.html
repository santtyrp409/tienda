<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Tienda Online de Comidas</title>

<style>
body {
    font-family: Arial, sans-serif;
    background-color: #f4f4f4;
    margin: 0;
}

header {
    background-color: #e63946;
    color: white;
    padding: 20px;
    text-align: center;
}

.horario {
    background: #333;
    color: white;
    text-align: center;
    padding: 8px;
}

section {
    padding: 20px;
}

.item, .pedido {
    background: white;
    padding: 15px;
    margin-bottom: 10px;
    border-radius: 8px;
}

button {
    background-color: #e63946;
    color: white;
    border: none;
    padding: 6px 10px;
    border-radius: 5px;
    cursor: pointer;
}

button.quitar {
    background-color: #555;
    margin-left: 5px;
}

input, textarea, select {
    width: 100%;
    padding: 8px;
    margin-bottom: 10px;
}

.total {
    font-size: 18px;
    font-weight: bold;
}

/* Pantalla final */
#final {
    display: none;
    background: white;
    padding: 20px;
    margin: 20px;
    border-radius: 10px;
}

#final h2 {
    text-align: center;
}
</style>
</head>

<body>

<header>
    <h1>üçî Mi Tienda de Comidas</h1>
    <p>Pedidos online</p>
</header>

<div class="horario">
    üïí Horario: 19:00 a 23:30
</div>

<section id="menu">
    <h2>üìã Men√∫</h2>

    <div class="item">
        <h3>Cheeseburger</h3>
        <p>$5</p>

        <!-- EXTRAS -->
        <div>
            <p><strong>Extras:</strong></p>
            <label><input type="checkbox" id="extraCarne"> Extra carne (+$2)</label><br>
            <label><input type="checkbox" id="extraCheddar"> Cheddar (+$1)</label><br>
            <label><input type="checkbox" id="extraPanceta"> Panceta (+$1.5)</label><br>
            <label><input type="checkbox" id="extraCebolla"> Cebolla (+$0.5)</label>
        </div>

        <button onclick="agregarCheeseburger()">Agregar</button>
    </div>

    <div class="item">
        <h3>Pizza</h3>
        <p>$7</p>
        <button onclick="agregar('Pizza', 7)">Agregar</button>
    </div>

    <div class="item">
        <h3>Papas Fritas</h3>
        <p>$3</p>
        <button onclick="agregar('Papas Fritas', 3)">Agregar</button>
    </div>
</section>

<section class="pedido">
    <h2>üõí Tu Pedido</h2>
    <ul id="listaPedido"></ul>

    <p>Env√≠o: $<span id="envio">2</span></p>
    <p class="total">Total Final: $<span id="total">0</span></p>
</section>

<section id="datos">
    <h2>üìù Datos del Cliente</h2>

    <label>Nombre</label>
    <input type="text" id="nombre">

    <label>Forma de pago</label>
    <div style="display:flex; gap:15px; margin-bottom:10px;">
        <label><input type="radio" name="pago" value="Efectivo" checked> Efectivo</label>
        <label><input type="radio" name="pago" value="Transferencia"> Transferencia</label>
    </div>

    <label>Direcci√≥n</label>
    <input type="text" id="direccion">

    <label>Descripci√≥n / Comentarios</label>
    <textarea id="comentario"></textarea>

    <button onclick="confirmarPedido()">‚úÖ Confirmar Pedido</button>
</section>

<!-- PANTALLA FINAL -->
<div id="final">
    <h2>üìå Confirmaci√≥n de Pedido</h2>
    <div id="resumen"></div>
    <p><strong>Total final:</strong> $<span id="totalFinal"></span></p>

    <button id="btnPago" style="display:none;" onclick="irMercadoPago()">üí≥ Pagar con Mercado Pago</button>
    <button onclick="volver()">‚Ü©Ô∏è Volver al men√∫</button>
</div>

<script>
let pedido = {};
let envio = 2;
let totalFinalGlobal = 0;

function agregar(nombre, precio) {
    if (!pedido[nombre]) {
        pedido[nombre] = { precio, cantidad: 1 };
    } else {
        pedido[nombre].cantidad++;
    }
    actualizarPedido();
}

function agregarCheeseburger() {
    let precioBase = 5;
    let nombre = "Cheeseburger";

    let extras = [];
    let precioExtras = 0;

    if (document.getElementById("extraCarne").checked) {
        extras.push("Extra carne (+$2)");
        precioExtras += 2;
    }
    if (document.getElementById("extraCheddar").checked) {
        extras.push("Cheddar (+$1)");
        precioExtras += 1;
    }
    if (document.getElementById("extraPanceta").checked) {
        extras.push("Panceta (+$1.5)");
        precioExtras += 1.5;
    }
    if (document.getElementById("extraCebolla").checked) {
        extras.push("Cebolla (+$0.5)");
        precioExtras += 0.5;
    }

    let nombreFinal = nombre;
    if (extras.length > 0) {
        nombreFinal += " (" + extras.join(", ") + ")";
    }

    agregar(nombreFinal, precioBase + precioExtras);

    document.getElementById("extraCarne").checked = false;
    document.getElementById("extraCheddar").checked = false;
    document.getElementById("extraPanceta").checked = false;
    document.getElementById("extraCebolla").checked = false;
}

function quitar(nombre) {
    pedido[nombre].cantidad--;
    if (pedido[nombre].cantidad <= 0) delete pedido[nombre];
    actualizarPedido();
}

function actualizarPedido() {
    let lista = document.getElementById("listaPedido");
    let total = 0;
    lista.innerHTML = "";

    for (let item in pedido) {
        let subtotal = pedido[item].precio * pedido[item].cantidad;
        total += subtotal;

        let li = document.createElement("li");
        li.innerHTML =
            item + " x" + pedido[item].cantidad +
            " - $" + subtotal +
            ` <button class="quitar" onclick="quitar('${item}')">‚àí</button>`;
        lista.appendChild(li);
    }

    document.getElementById("total").textContent = total + envio;
}

function confirmarPedido() {
    if (Object.keys(pedido).length === 0) {
        alert("Agreg√° al menos un producto");
        return;
    }

    let nombre = document.getElementById("nombre").value;
    let pago = document.querySelector('input[name="pago"]:checked').value;
    let direccion = document.getElementById("direccion").value;
    let comentario = document.getElementById("comentario").value;

    let detalleTexto = "";
    let detallePrint = "";
    let total = 0;

    for (let item in pedido) {
        let subtotal = pedido[item].precio * pedido[item].cantidad;
        total += subtotal;
        detalleTexto += `${item} x${pedido[item].cantidad} - $${subtotal}%0A`;
        detallePrint += `${item} x${pedido[item].cantidad} - $${subtotal}\n`;
    }

    let totalFinal = total + envio;
    totalFinalGlobal = totalFinal;

    // WHATSAPP
    let mensaje =
        "üçî NUEVO PEDIDO%0A%0A" +
        "Nombre: " + nombre + "%0A" +
        "Direcci√≥n: " + direccion + "%0A" +
        "Pago: " + pago + "%0A" +
        "Comentario: " + comentario + "%0A%0A" +
        "Pedido:%0A" + detalleTexto +
        "Env√≠o: $2%0A" +
        "TOTAL: $" + totalFinal;

    window.open(
        "https://wa.me/5491162911053?text=" + mensaje,
        "_blank"
    );

    // IMPRIMIR COMANDA
    let ventana = window.open("", "PRINT", "width=400,height=600");
    ventana.document.write(`
        <html>
        <head>
            <title>Comanda</title>
            <style>
                body { font-family: monospace; }
                h2 { text-align: center; }
                pre { font-size: 14px; }
            </style>
        </head>
        <body>
            <h2>üßæ COMANDA</h2>
            <p><strong>Cliente:</strong> ${nombre}</p>
            <p><strong>Direcci√≥n:</strong> ${direccion}</p>
            <p><strong>Pago:</strong> ${pago}</p>
            <hr>
            <pre>${detallePrint}</pre>
            <p><strong>Env√≠o:</strong> $2</p>
            <p><strong>TOTAL:</strong> $${totalFinal}</p>
            <p><strong>Obs:</strong> ${comentario}</p>
        </body>
        </html>
    `);

    ventana.document.close();
    ventana.focus();
    ventana.print();
    ventana.close();

    // MOSTRAR PANTALLA FINAL
    document.getElementById("menu").style.display = "none";
    document.getElementById("datos").style.display = "none";
    document.getElementById("final").style.display = "block";

    let resumen = document.getElementById("resumen");
    resumen.innerHTML = detallePrint.replace(/\n/g, "<br>");

    document.getElementById("totalFinal").innerText = totalFinal;

    // Mostrar bot√≥n de Mercado Pago SOLO si eligi√≥ Transferencia
    if (pago === "Transferencia") {
        document.getElementById("btnPago").style.display = "block";
    } else {
        document.getElementById("btnPago").style.display = "none";
    }
}

function irMercadoPago() {
    let linkMP = "https://link.mercadopago.com.ar/frakev";

    // COPIAR TOTAL AL PORTAPAPELES
    navigator.clipboard.writeText(totalFinalGlobal.toString())
        .then(() => {
            alert("Total a pagar: $" + totalFinalGlobal + "\nSe copi√≥ el monto al portapapeles.\nAhora se abrir√° Mercado Pago.");
        })
        .catch(() => {
            alert("Total a pagar: $" + totalFinalGlobal + "\nAhora se abrir√° Mercado Pago.");
        });

    // REDIRECCIONAR A MERCADO PAGO EN LA MISMA PESTA√ëA
    window.location.href = linkMP;
}

function volver() {
    document.getElementById("menu").style.display = "block";
    document.getElementById("datos").style.display = "block";
    document.getElementById("final").style.display = "none";
}
</script>

</body>
</html>
